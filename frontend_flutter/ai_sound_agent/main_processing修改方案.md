本次调整主要针对`main_processing.dart`

## 整体概念
### 优化后的工作描述
#### 任务目标
对`main_processing.dart`文件对应的前端界面进行结构化简化与交互逻辑重构，优化用户操作路径，提升界面易用性与视觉简洁度。

#### 核心优化项
1. **界面结构精简**
   - 移除`main_processing.dart`界面中完整的侧边栏布局结构，清理侧边栏关联的冗余代码与样式；
   - 删除侧边栏内“情景补充”等无业务价值的功能模块及对应的交互逻辑、数据绑定关系。

2. **功能模块整合**
   - 将“用户意见”模块的输入功能整合至原有核心输入框中，统一输入入口，同步调整输入框的参数配置、数据处理逻辑以适配整合后的内容；
   - 梳理“用户倾向选择”“llm_response选择”两类功能模块的交互逻辑，将其迁移至核心输入框下方区域，实现类微信的标签式切换交互效果（含选项切换、状态记忆、内容联动展示等逻辑）。

3. **交互组件新增与重构**
   - 在核心输入框右侧新增功能按钮（对标微信聊天界面“+”按钮），定义按钮的样式、点击触发事件及交互反馈；
   - 配置该按钮的点击响应逻辑：点击后保留输入框内现有文本内容，触发输入框下方AI生成面板的升起动效；
   - 完成AI生成面板的布局开发与交互逻辑适配，包括面板的显隐动画、层级管理、与输入框/切换选项的联动规则等。

#### 交付要求
- 保证界面简化后核心业务流程不中断，数据传输、交互响应符合原有业务规则；
- 新增/调整的交互组件（切换选项、功能按钮、AI面板）需满足前端交互规范，动效流畅、样式统一；
- 清理冗余代码，保证`main_processing.dart`文件代码结构清晰，注释完整，便于后续维护。

## 要保留的东西

### UI
- 顶部上边的导航栏
- 整体的对话架构
- 下方的消息输入框和人物选择区

### 流程

**保留所有前后端通讯的代码， 主要更改UI**

#### 1. 对话初始化阶段
- **前端操作**：加载对话包（DP文件），初始化角色管理器
- **WebSocket通信**：发送 `conversation_start` 事件，包含历史消息、场景描述、回答数量等
- **后端响应**：返回 `session_created` 事件，分配唯一会话ID
- **状态管理**：从加载状态转为空闲状态

#### 2. 消息录制和处理阶段
- **录音开始**：用户点击录音按钮，发送 `message_start` 事件
- **音频流传输**：持续发送 `audio_stream` 事件（PCM16格式，16kHz采样率）
- **录音结束**：发送 `message_end` 事件
- **后端处理**：完成语音转文字，返回 `message_recorded` 事件
- **界面更新**：将转录的消息添加到对话界面

## 要删除/更改的东西

### UI
- 整个左侧侧边栏的所有内容
- 进入侧边栏的按钮

我们需要将整个llm回答展示部分移至输入框下方，并且修改逻辑

### 流程
### 3.1 用户意见倾向选择
#### 意见预测响应 (opinion_prediction_response)
```json
{
  "type": "opinion_prediction_response", // [必需]
  "data": {
    "session_id": "会话ID", // [必需]
    "prediction": { // [必需]
      "tendency": "合作 | 对抗 | 中立 | 探索 | 安抚", // [必需] 预测的意见倾向
      "mood": "积极 | 消极 | 平静 | 好奇 | 困惑", // [必需] 预测的心情
      "tone": "正式 | 随意 | 坚定 | 委婉 | 幽默" // [必需] 预测的语气
    },
    "request_id": "请求唯一标识" // [可选] 用于请求追踪
  }
}
```
将这一块生成的内容整合到输入框下方，用户可以直接在输入框中查看和选择。选择完成之后直接发送如下信息：
```json
{
  "type": "user_modification", // [必需]
  "data": {
    "session_id": "会话ID", // [必需]
    "modification": "所选择的意见" // [必需] 对AI回复的修改意见
  }
}
```

### 3.2 手动回答生成阶段
- **触发生成**：用户在输入框产生文字变动时，且距离上一次记录已经超过5000ms，则进行新的一次生成，发送 `manual_generate` 事件
- **处理状态**：显示"生成回答建议中"状态
- **接收建议**：后端返回 `llm_response` 事件，包含多个AI回答建议
- **展示选项**：在界面显示所有回答建议供用户选择

注意，这里再用户输入意见之后，需要先发送
```
{
  "type": "user_modification", // [必需]
  "data": {
    "session_id": "会话ID", // [必需]
    "modification": "用户当前想法：" + "用户输入的文字" // [必需] 对AI回复的修改意见
  }
}
```


### 4. 用户选择和反馈阶段
- **选择回答**：用户点击建议按钮，发送 `user_selected_response` 事件
- **意见预测**（可选）：后端可能返回 `opinion_prediction_response` 事件，包含心态预测
- **语音播放**：使用TTS将选中的回答转换为语音播放
- **界面更新**：将选中的回答添加到对话中

### 5. 对话继续或结束
- **继续对话**：返回阶段2，开始新的消息录制
- **结束对话**：发送 `conversation_end` 事件，清理会话状态

## 前后端通信流程详解

### 前端发送的主要事件：
1. **conversation_start** - 初始化对话会话
2. **message_start** - 开始录制消息
3. **audio_stream** - 传输音频数据块
4. **message_end** - 结束消息录制
5. **manual_generate** - 手动触发AI回答生成
6. **user_selected_response** - 用户选择AI回答
7. **user_modification** - 用户提交修改建议
8. **response_count_update** - 更新回答数量
9. **conversation_end** - 结束对话会话
10. **session_resume** - 恢复之前的会话

### 后端返回的主要事件：
1. **session_created** - 会话创建确认
2. **message_recorded** - 消息记录确认
3. **llm_response** - AI回答建议
4. **opinion_prediction_response** - 意见预测结果
5. **status_update** - 状态更新通知
6. **session_restored** - 会话恢复成功
7. **error** - 错误信息

### 关键特性：
- **断线重连机制**：支持最多5次指数退避重连，可恢复会话状态
- **音频流处理**：采用PCM16格式，16kHz采样率，分块传输
- **状态持久化**：自动保存对话进度到current.dp文件
- **角色管理**：支持多角色对话，自动识别消息发送者
- **TTS集成**：支持文本转语音播放
- **会话恢复**：支持从本地存储恢复之前的对话状态

这个流程设计确保了语音对话的实时性、可靠性和用户体验的连续性。