## TTS功能问题分析与修复计划

### 问题分析
1. **设备支持检测缺失**：当前代码没有检测设备是否支持TTS功能
2. **缺少用户提示**：当设备不支持TTS时，没有友好的错误提示
3. **TTS测试功能缺失**：用户反馈测试按钮无法使用
4. **触发机制问题**：发送消息时可能无法正确触发语音合成
5. **错误处理不完善**：TTS初始化和使用过程中的错误没有充分处理

### 修复方案

#### 1. 添加TTS可用性检测
- 在`_initializeTts()`方法中添加设备支持检测
- 使用`FlutterTts`的`isLanguageAvailable()`方法检查语言支持
- 添加`_isTtsAvailable`状态变量跟踪TTS可用性

#### 2. 完善TTS初始化流程
- 修改`_initializeTts()`方法，添加更详细的错误处理
- 在初始化失败时设置`_isTtsAvailable = false`
- 添加初始化状态的用户反馈

#### 3. 添加TTS测试功能
- 实现TTS测试按钮和相关方法
- 测试按钮点击时使用预设文本测试TTS功能
- 显示测试结果反馈

#### 4. 修复TTS触发机制
- 检查`_speakLastSentMessage()`方法的调用时机
- 确保消息发送后正确触发TTS
- 添加更详细的调试日志

#### 5. 添加设备不支持TTS的提示
- 在界面上添加TTS状态指示器
- 当设备不支持TTS时显示友好的提示信息
- 提供可能的解决方案建议（如安装TTS引擎）

#### 6. 改进用户体验
- 添加TTS功能开关选项
- 优化TTS错误提示的用户界面
- 确保TTS功能的状态对用户可见

### 技术实现要点
- 使用`try-catch`捕获TTS相关异常
- 利用`FlutterTts`的回调方法监控TTS状态
- 添加状态管理变量跟踪TTS可用性
- 实现用户友好的错误提示机制
- 确保TTS功能的可靠性和稳定性

### 预期效果
- 设备不支持TTS时显示明确的提示信息
- TTS测试按钮正常工作
- 发送消息时TTS语音合成功能正常触发
- 提供更好的用户体验和错误反馈