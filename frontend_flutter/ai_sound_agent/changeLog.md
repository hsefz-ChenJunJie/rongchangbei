## Change log

# Date: 2025-11-21 , patch=1
- 更新接口实现以匹配文档要求：
    - 音频流格式改为opus编码
    - 移除profile_prompt字段
    - 添加会话恢复和错误处理

# Date: 2025-11-21 , patch=2
- 修复LoadingStep.loading枚举值不存在的问题，改为使用sendingStartRequest
- 完善session_restored消息处理逻辑，支持完整的会话恢复功能
- 添加error消息处理，增强错误处理机制

# Date: 2025-11-21 , patch=3
- 整合对话人档案页面与对话人管理页面：
    - 在对话人管理页面每个对话人卡片中添加档案编辑按钮
    - 点击档案编辑按钮可直接进入档案编辑页面
    - 在档案编辑页面添加示例文本生成按钮
    - 示例文本生成功能可生成包含姓名、城市、星座、爱好等信息的示例文本

# Date: 2025-11-21 , patch=4
- 重构档案编辑页面界面设计：
    - 主界面显示大文本框，实时展示整合后的自然语言描述
    - 表单填写时实时更新文本框内容（如："名字叫小陈，年龄为37岁，不喜欢谈论疾病史"）
    - 添加"显示/隐藏编辑表单"切换按钮，简化界面
    - 发送到后端的信息为自然语言文本，非JSON格式
    - 最终文本直接展示给用户，并标注"最终发送给AI"

# Date: 2025-11-22 , patch=1

1. 修改对话启动逻辑
    在 _establishWebSocketConnection 方法中，我修改了场景描述的构建逻辑：

    - 当存在当前聊天对象时，会在原场景描述后附加聊天对象的详细信息
    - 格式为： 原对话情景描述文本\n\n你现在的聊天对象：[详细信息]
2. 添加详细信息构建方法
    新增了 _buildPartnerInfoString 方法，用于构建聊天对象的详细信息字符串，包含：

    - 基本信息 ：姓名、关系类型
    - 年龄性别 ：如果有设置则显示
    - 性格特点 ：列出所有性格标签
    - 禁忌话题 ：如果有设置则显示
    - 共同经历 ：如果有设置则显示

# Date: 2025-11-22 , patch=2
添加"我想想……"填充消息功能：
- 在用户发送消息到LLM后，有30%概率触发"我想想……"填充消息
- 填充消息会在1-3秒延迟后显示，模拟AI思考时间
- 消息以系统身份显示，使用灰色样式区分于正常对话
- 仅在会话连接正常时才会显示填充消息

# Date: 2025-11-22 , patch=3
- Fixed RenderFlex overflow issue in main_processing.dart by reducing vertical padding from 8px to 6px in top action bar and profile selector containers

# Date: 2025-11-22 , patch=4
- 优化聊天界面进入逻辑：
    - 从主页进入聊天界面时，不再强制选择对话人profile
    - 从对话人管理页面进入时，自动使用对应对话人的profile
    - 避免因用户再次选择导致无法及时发送并开启对话
    - 当存在当前聊天对象时，会在原场景描述后附加其详细信息

# Date: 2025-11-22 , patch=5
- 删除主聊天界面顶部的对话人档案选择器：
    - 移除main_processing.dart中的档案选择下拉框
    - 保持对话人档案功能在后台正常工作
    - 简化界面，避免用户重复选择档案
    - 从对话人管理页面进入时仍自动使用对应档案
