# AIå¯¹è¯åº”ç”¨åç«¯ - è¿œç¨‹APIæµ‹è¯•å¥—ä»¶

å®Œæ•´çš„è¿œç¨‹åç«¯APIæµ‹è¯•æ¡†æ¶ï¼Œç”¨äºéªŒè¯éƒ¨ç½²åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„AIå¯¹è¯åº”ç”¨åç«¯åŠŸèƒ½ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. é…ç½®æµ‹è¯•ç¯å¢ƒ

```bash
# å¤åˆ¶é…ç½®æ–‡ä»¶æ¨¡æ¿
cp remote_test_config.example.json remote_test_config.json

# ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®è¿œç¨‹æœåŠ¡å™¨åœ°å€
nano remote_test_config.json
```

### 2. é…ç½®ç¤ºä¾‹

```json
{
  "backend_server": {
    "base_url": "http://YOUR_REMOTE_SERVER_IP",
    "port": 8000,
    "health_endpoint": "/",
    "conversation_health_endpoint": "/conversation/health",
    "websocket_endpoint": "/conversation"
  },
  "test_settings": {
    "connection_timeout": 15,
    "response_timeout": 45,
    "max_retries": 3,
    "enable_detailed_logging": true
  }
}
```

### 3. è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆæ¨èï¼‰
python run_remote_tests.py

# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶
python run_remote_tests.py my_config.json

# å•ç‹¬è¿è¡Œç‰¹å®šæµ‹è¯•
python test_websocket_features.py
python test_conversation_features.py
```

## ğŸ“ æ–‡ä»¶ç»“æ„

```
tests/backend/
â”œâ”€â”€ README.md                          # æœ¬æ–‡æ¡£
â”œâ”€â”€ EVENT_LOGGING.md                   # ğŸ“ äº‹ä»¶æ—¥å¿—ç³»ç»Ÿè¯¦ç»†è¯´æ˜
â”œâ”€â”€ remote_test_config.json            # æµ‹è¯•é…ç½®æ–‡ä»¶
â”œâ”€â”€ remote_test_config.example.json    # é…ç½®æ–‡ä»¶æ¨¡æ¿
â”œâ”€â”€ remote_test_base.py                 # æµ‹è¯•åŸºç¡€ç±»ï¼ˆå«è¯¦ç»†äº‹ä»¶æ—¥å¿—ï¼‰
â”œâ”€â”€ run_remote_tests.py                 # ç»¼åˆæµ‹è¯•è¿è¡Œå™¨
â”œâ”€â”€ test_websocket_features.py          # WebSocketåŠŸèƒ½æµ‹è¯•
â”œâ”€â”€ test_conversation_features.py       # å®Œæ•´å¯¹è¯åŠŸèƒ½æµ‹è¯•
â””â”€â”€ services/                           # ä¿ç•™çš„ç‰¹æ®Šæµ‹è¯•
```

## ğŸ“ æ–°å¢åŠŸèƒ½ï¼šè¯¦ç»†äº‹ä»¶æ—¥å¿—ç³»ç»Ÿ

âœ¨ **v1.2.0 é‡è¦æ›´æ–°**ï¼šä¸ºäº†æ›´å¥½åœ°è°ƒè¯•å’Œåˆ†ææµ‹è¯•è¿‡ç¨‹ï¼Œç°å·²æ–°å¢å®Œæ•´çš„äº‹ä»¶æ—¥å¿—è®°å½•åŠŸèƒ½ï¼

### æ ¸å¿ƒç‰¹æ€§
- ğŸ¯ **å®Œæ•´è®°å½•**ï¼šè®°å½•æ¯ä¸ªå‘å‡ºå’Œæ¥æ”¶çš„WebSocketäº‹ä»¶
- â±ï¸ **æ€§èƒ½åˆ†æ**ï¼šåŒ…å«æ—¶é—´æˆ³ã€å“åº”æ—¶é—´ã€æ•°æ®å¤§å°ç­‰å…ƒæ•°æ®
- ğŸ”’ **éšç§ä¿æŠ¤**ï¼šè‡ªåŠ¨è„±æ•éŸ³é¢‘æ•°æ®å’Œæ•æ„Ÿä¿¡æ¯
- ğŸ“Š **æ™ºèƒ½ç»Ÿè®¡**ï¼šè‡ªåŠ¨ç”Ÿæˆäº‹ä»¶ç±»å‹ã€æˆåŠŸç‡ã€æ€§èƒ½ç»Ÿè®¡
- ğŸ¨ **å¯è§†åŒ–å±•ç¤º**ï¼šå½©è‰²æ ¼å¼åŒ–çš„æ§åˆ¶å°è¾“å‡º
- ğŸ’¾ **å¤šæ ¼å¼è¾“å‡º**ï¼šæ”¯æŒæ§åˆ¶å°ã€JSONæ–‡ä»¶ã€ç»“æ„åŒ–æ—¥å¿—æ–‡ä»¶

### å¿«é€Ÿé…ç½®
```json
{
  "test_settings": {
    "enable_detailed_logging": true,    // æ˜¾ç¤ºè¯¦ç»†äº‹ä»¶æ—¥å¿—
    "enable_file_logging": true,        // ä¿å­˜åˆ°æ—¥å¿—æ–‡ä»¶
    "log_level": "DEBUG",               // æ—¥å¿—çº§åˆ«
    "show_list_items": true,            // æ˜¾ç¤ºåˆ—è¡¨è¯¦ç»†å†…å®¹
    // ... å…¶ä»–é…ç½®
  }
}
```

### è¾“å‡ºç¤ºä¾‹
```
â”Œâ”€ [001] 14:23:45.123 ğŸ“¤ SEND âœ…
â”œâ”€ Event: conversation_start
â”œâ”€ Session: abc123...
â”œâ”€ Data:
â”‚  â”œâ”€ scenario_description: "é¡¹ç›®ç®¡ç†è®¨è®ºä¼šè®®"
â”‚  â”œâ”€ response_count: 3
â”œâ”€ Metadata:
â”‚  â””â”€ response_time: 0.001s
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

ğŸ“š **è¯¦ç»†æ–‡æ¡£**ï¼šæŸ¥çœ‹ [EVENT_LOGGING.md](EVENT_LOGGING.md) äº†è§£å®Œæ•´åŠŸèƒ½å’Œä½¿ç”¨æŒ‡å—

## ğŸ§ª æµ‹è¯•å¥—ä»¶

### 1. WebSocketåŠŸèƒ½æµ‹è¯• (`test_websocket_features.py`)

- âœ… WebSocketè¿æ¥å»ºç«‹
- âœ… å¯¹è¯å¼€å§‹å’Œä¼šè¯åˆ›å»º
- âœ… éŸ³é¢‘æ¶ˆæ¯æµç¨‹ï¼ˆSTTæ¨¡æ‹Ÿï¼‰
- âœ… LLMå›ç­”ç”Ÿæˆ
- âœ… å›ç­”æ•°é‡åŠ¨æ€è°ƒæ•´
- âœ… ä¼šè¯æ¢å¤åŠŸèƒ½ï¼ˆå¦‚æœå¯ç”¨ï¼‰

### 2. å®Œæ•´å¯¹è¯åŠŸèƒ½æµ‹è¯• (`test_conversation_features.py`)

- âœ… å¤šç”¨æˆ·å¯¹è¯æ¨¡æ‹Ÿ
- âœ… èšç„¦æ¶ˆæ¯çš„å›ç­”ç”Ÿæˆ
- âœ… ç”¨æˆ·ä¿®æ”¹å»ºè®®å¤„ç†
- âœ… ç”¨æˆ·é€‰æ‹©å›ç­”è®°å½•
- âœ… æƒ…æ™¯è¡¥å……åŠŸèƒ½
- âœ… å¯¹è¯æŒä¹…æ€§æµ‹è¯•

## ğŸ“Š æµ‹è¯•æŠ¥å‘Š

æµ‹è¯•å®Œæˆåä¼šç”Ÿæˆå¤šç§æ ¼å¼çš„æŠ¥å‘Šï¼š

- **ç»¼åˆæ–‡æœ¬æŠ¥å‘Š**: `comprehensive_remote_test_report_YYYYMMDD_HHMMSS.txt`
- **è¯¦ç»†JSONæ•°æ®**: `comprehensive_remote_test_data_YYYYMMDD_HHMMSS.json`
- **å•ç‹¬æµ‹è¯•æŠ¥å‘Š**: `websocket_test_report_YYYYMMDD_HHMMSS.json`

### ğŸ†• äº‹ä»¶æ—¥å¿—æ–‡ä»¶ï¼ˆæ–°å¢ï¼‰
- **çº¯äº‹ä»¶æ—¥å¿—**: `*_events.json` - åŒ…å«å®Œæ•´çš„äº‹ä»¶åºåˆ—å’Œç»Ÿè®¡
- **ç»“æ„åŒ–æ—¥å¿—**: `event_log_YYYYMMDD_HHMMSS.log` - å¯è¯»çš„æ—¶åºæ—¥å¿—ï¼ˆå¦‚å¯ç”¨ï¼‰
- **äº‹ä»¶ç»Ÿè®¡**: é›†æˆåœ¨æµ‹è¯•æŠ¥å‘Šä¸­ï¼ŒåŒ…å«æ€§èƒ½åˆ†æå’Œé”™è¯¯ç»Ÿè®¡

## âš™ï¸ é…ç½®é€‰é¡¹

### æœåŠ¡å™¨é…ç½® (`backend_server`)

| é…ç½®é¡¹ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| `base_url` | è¿œç¨‹æœåŠ¡å™¨åŸºç¡€URL | `http://192.168.1.100` |
| `port` | æœåŠ¡å™¨ç«¯å£ | `8000` |
| `websocket_endpoint` | WebSocketè¿æ¥ç«¯ç‚¹ | `/conversation` |

### æµ‹è¯•è®¾ç½® (`test_settings`)

| é…ç½®é¡¹ | è¯´æ˜ | æ¨èå€¼ |
|--------|------|--------|
| `connection_timeout` | è¿æ¥è¶…æ—¶ï¼ˆç§’ï¼‰ | `15` |
| `response_timeout` | å“åº”è¶…æ—¶ï¼ˆç§’ï¼‰ | `45` |
| `enable_detailed_logging` | å¯ç”¨è¯¦ç»†äº‹ä»¶æ—¥å¿—æ˜¾ç¤º | `true` |
| `enable_file_logging` | å¯ç”¨äº‹ä»¶æ—¥å¿—æ–‡ä»¶è®°å½• | `false` |
| `log_level` | æ—¥å¿—çº§åˆ«ï¼ˆDEBUG/INFO/WARNING/ERRORï¼‰ | `INFO` |
| `show_list_items` | æ˜¾ç¤ºåˆ—è¡¨é¡¹è¯¦ç»†å†…å®¹ | `false` |
| `test_audio_chunks` | æ¨¡æ‹ŸéŸ³é¢‘å—æ•°é‡ | `5` |

### ä¼šè¯æ¢å¤æµ‹è¯• (`session_recovery_test`)

| é…ç½®é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| `enable_session_recovery_test` | å¯ç”¨ä¼šè¯æ¢å¤æµ‹è¯• | `true` |
| `disconnect_duration` | æ–­å¼€æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰ | `5` |

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **è¿æ¥è¶…æ—¶**
   ```
   âŒ WebSocketè¿æ¥è¶…æ—¶
   ```
   - æ£€æŸ¥æœåŠ¡å™¨åœ°å€å’Œç«¯å£
   - ç¡®è®¤æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
   - éªŒè¯ç½‘ç»œè¿æ¥

2. **æµ‹è¯•å¤±è´¥**
   ```
   âŒ å¯¹è¯æµç¨‹æµ‹è¯•å¤±è´¥
   ```
   - æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
   - æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—
   - éªŒè¯APIé…ç½®ï¼ˆå¦‚OpenRouterå¯†é’¥ï¼‰

3. **ä¼šè¯æ¢å¤å¤±è´¥**
   ```
   âš ï¸ ä¼šè¯æ¢å¤åŠŸèƒ½æ­£å¸¸ï¼ˆä¼šè¯å·²è¿‡æœŸï¼‰
   ```
   - è¿™æ˜¯æ­£å¸¸æƒ…å†µï¼Œè¡¨ç¤ºä¼šè¯æŒä¹…åŒ–åŠŸèƒ½å·¥ä½œæ­£å¸¸
   - å¯ä»¥è°ƒæ•´ `disconnect_duration` è¿›è¡Œæ›´ä¸¥æ ¼çš„æµ‹è¯•

### è°ƒè¯•æŠ€å·§

1. **å¯ç”¨è¯¦ç»†æ—¥å¿—**
   ```json
   {
     "test_settings": {
       "enable_detailed_logging": true
     }
   }
   ```

2. **å¢åŠ è¶…æ—¶æ—¶é—´**
   ```json
   {
     "test_settings": {
       "connection_timeout": 30,
       "response_timeout": 60
     }
   }
   ```

3. **å•æ­¥è°ƒè¯•**
   ```bash
   # å…ˆæµ‹è¯•åŸºç¡€è¿æ¥
   python test_websocket_features.py
   
   # å†æµ‹è¯•å®Œæ•´åŠŸèƒ½
   python test_conversation_features.py
   ```

## ğŸ¯ æˆåŠŸæ ‡å‡†

- **ä¼˜ç§€** (100%): æ‰€æœ‰æµ‹è¯•é€šè¿‡
- **è‰¯å¥½** (â‰¥80%): å¤§éƒ¨åˆ†æµ‹è¯•é€šè¿‡ï¼Œæ ¸å¿ƒåŠŸèƒ½æ­£å¸¸
- **å¯æ¥å—** (â‰¥70%): åŸºæœ¬åŠŸèƒ½æ­£å¸¸ï¼Œéƒ¨åˆ†é«˜çº§åŠŸèƒ½å¯èƒ½æœ‰é—®é¢˜
- **éœ€è¦æ£€æŸ¥** (<70%): å­˜åœ¨è¾ƒå¤šé—®é¢˜ï¼Œéœ€è¦æ’æŸ¥

## ğŸ’¡ æœ€ä½³å®è·µ

1. **æµ‹è¯•å‰æ£€æŸ¥**
   - ç¡®è®¤è¿œç¨‹æœåŠ¡å™¨æ­£å¸¸è¿è¡Œ
   - éªŒè¯ç½‘ç»œè¿æ¥ç¨³å®š
   - æ£€æŸ¥APIå¯†é’¥å’Œä¾èµ–æœåŠ¡

2. **å®šæœŸæµ‹è¯•**
   - åœ¨ä»£ç å˜æ›´åè¿è¡Œæµ‹è¯•
   - å®šæœŸæ£€æŸ¥ç”Ÿäº§ç¯å¢ƒçŠ¶æ€
   - ç›‘æ§æµ‹è¯•æˆåŠŸç‡è¶‹åŠ¿

3. **ç»“æœåˆ†æ**
   - å…³æ³¨å¤±è´¥æµ‹è¯•çš„å…·ä½“é”™è¯¯
   - å¯¹æ¯”å†å²æµ‹è¯•ç»“æœ
   - è¯†åˆ«æ€§èƒ½å›å½’é—®é¢˜

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. **æŸ¥çœ‹æŠ¥å‘Š**: æ£€æŸ¥ç”Ÿæˆçš„è¯¦ç»†æµ‹è¯•æŠ¥å‘Š
2. **æ£€æŸ¥é…ç½®**: éªŒè¯é…ç½®æ–‡ä»¶æ ¼å¼å’Œå†…å®¹
3. **ç½‘ç»œè¯Šæ–­**: ä½¿ç”¨pingã€telnetç­‰å·¥å…·æ£€æŸ¥è¿æ¥
4. **æœåŠ¡å™¨æ—¥å¿—**: æŸ¥çœ‹è¿œç¨‹æœåŠ¡å™¨çš„è¿è¡Œæ—¥å¿—
5. **ç‰ˆæœ¬å…¼å®¹**: ç¡®è®¤æµ‹è¯•è„šæœ¬ä¸æœåŠ¡å™¨ç‰ˆæœ¬å…¼å®¹

---

è¿™å¥—æµ‹è¯•æ¡†æ¶è®¾è®¡ä¸ºç‹¬ç«‹ã€å¯é ã€æ˜“äºä½¿ç”¨çš„å·¥å…·ï¼Œå¸®åŠ©æ‚¨å¿«é€ŸéªŒè¯è¿œç¨‹AIå¯¹è¯åº”ç”¨åç«¯çš„åŠŸèƒ½å’Œæ€§èƒ½ã€‚