# äº‹ä»¶æ—¥å¿—ç³»ç»Ÿè¯´æ˜

## æ¦‚è¿°

ä¸ºäº†æ›´å¥½åœ°è°ƒè¯•å’Œåˆ†ææµ‹è¯•è¿‡ç¨‹ä¸­çš„WebSocketé€šä¿¡ï¼Œæˆ‘ä»¬ä¸ºè¿œç¨‹æµ‹è¯•ç³»ç»Ÿå¢åŠ äº†è¯¦ç»†çš„äº‹ä»¶æ—¥å¿—åŠŸèƒ½ã€‚è¯¥ç³»ç»Ÿèƒ½å¤Ÿè®°å½•æ¯ä¸€ä¸ªå‘å‡ºå’Œæ¥æ”¶çš„äº‹ä»¶ï¼ŒåŒ…æ‹¬è¯¦ç»†çš„å…ƒæ•°æ®å’Œç»Ÿè®¡ä¿¡æ¯ã€‚

## ä¸»è¦åŠŸèƒ½

### ğŸ“ è¯¦ç»†äº‹ä»¶è®°å½•
- **å‘é€äº‹ä»¶**ï¼šè®°å½•æ¯ä¸ªå‘æœåŠ¡å™¨å‘é€çš„WebSocketäº‹ä»¶
- **æ¥æ”¶äº‹ä»¶**ï¼šè®°å½•æ¯ä¸ªä»æœåŠ¡å™¨æ¥æ”¶çš„WebSocketäº‹ä»¶
- **HTTPè¯·æ±‚**ï¼šè®°å½•å¥åº·æ£€æŸ¥ç­‰HTTPè¯·æ±‚
- **è¿æ¥äº‹ä»¶**ï¼šè®°å½•WebSocketè¿æ¥å»ºç«‹è¿‡ç¨‹

### â±ï¸ æ—¶é—´å’Œæ€§èƒ½ç»Ÿè®¡
- äº‹ä»¶æ—¶é—´æˆ³ï¼ˆç²¾ç¡®åˆ°æ¯«ç§’ï¼‰
- å“åº”æ—¶é—´æµ‹é‡
- è¶…æ—¶è®¾ç½®è®°å½•
- æ¶ˆæ¯å¤§å°ç»Ÿè®¡

### ğŸ”’ å®‰å…¨å’Œéšç§
- éŸ³é¢‘æ•°æ®è‡ªåŠ¨è„±æ•ï¼ˆåªæ˜¾ç¤ºé•¿åº¦ï¼‰
- æ•æ„Ÿå­—æ®µï¼ˆå¯†é’¥ã€ä»¤ç‰Œç­‰ï¼‰è‡ªåŠ¨éšè—
- æ”¯æŒé…ç½®æ•æ„Ÿä¿¡æ¯åˆ—è¡¨

### ğŸ“Š ç»Ÿè®¡åˆ†æ
- äº‹ä»¶æ€»æ•°å’Œåˆ†ç±»ç»Ÿè®¡
- æˆåŠŸ/å¤±è´¥äº‹ä»¶ç»Ÿè®¡
- å¹³å‡å“åº”æ—¶é—´è®¡ç®—
- ä¼šè¯çº§äº‹ä»¶ç»Ÿè®¡

## é…ç½®é€‰é¡¹

åœ¨ `remote_test_config.json` çš„ `test_settings` éƒ¨åˆ†é…ç½®ï¼š

```json
{
  "test_settings": {
    "enable_detailed_logging": true,    // å¯ç”¨è¯¦ç»†æ—¥å¿—æ˜¾ç¤º
    "enable_file_logging": true,        // å¯ç”¨æ–‡ä»¶æ—¥å¿—è®°å½•
    "log_level": "DEBUG",               // æ—¥å¿—çº§åˆ«: DEBUG/INFO/WARNING/ERROR
    "show_list_items": true,            // æ˜¾ç¤ºåˆ—è¡¨é¡¹è¯¦ç»†å†…å®¹
    // ... å…¶ä»–é…ç½®
  }
}
```

### é…ç½®è¯´æ˜

- **enable_detailed_logging**: æ§åˆ¶æ˜¯å¦åœ¨æ§åˆ¶å°æ˜¾ç¤ºè¯¦ç»†çš„äº‹ä»¶æ—¥å¿—
- **enable_file_logging**: æ˜¯å¦å°†æ—¥å¿—ä¿å­˜åˆ°æ–‡ä»¶
- **log_level**: æ—¥å¿—è®°å½•çº§åˆ«ï¼Œå½±å“æ—¥å¿—è¯¦ç»†ç¨‹åº¦
- **show_list_items**: æ˜¯å¦å±•ç¤ºåˆ—è¡¨ç±»å‹å­—æ®µçš„è¯¦ç»†å†…å®¹

## æ—¥å¿—è¾“å‡ºæ ¼å¼

### æ§åˆ¶å°è¾“å‡º
```
â”Œâ”€ [001] 14:23:45.123 ğŸ“¤ SEND âœ…
â”œâ”€ Event: conversation_start
â”œâ”€ Session: abc123...
â”œâ”€ Data:
â”‚  â”œâ”€ scenario_description: "é¡¹ç›®ç®¡ç†è®¨è®ºä¼šè®®"
â”‚  â”œâ”€ response_count: 3
â”œâ”€ Metadata:
â”‚  â””â”€ response_time: 0.001s
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

### æ—¥å¿—æ–‡ä»¶æ ¼å¼
```
14:23:45.123 [WebSocketFeatureTester_events] INFO: âœ… [SEND] conversation_start (session: abc123...) [count=3] (time: 0.001s)
```

## è¾“å‡ºæ–‡ä»¶

æµ‹è¯•å®Œæˆåä¼šç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

1. **`*_test_report_*.json`** - å®Œæ•´æµ‹è¯•æŠ¥å‘Šï¼ŒåŒ…å«äº‹ä»¶æ—¥å¿—
2. **`*_events.json`** - çº¯äº‹ä»¶æ—¥å¿—æ•°æ®
3. **`event_log_*.log`** - ç»“æ„åŒ–æ—¥å¿—æ–‡ä»¶ï¼ˆå¦‚æœå¯ç”¨æ–‡ä»¶æ—¥å¿—ï¼‰

## äº‹ä»¶ç±»å‹

### è¿æ¥ç›¸å…³
- `websocket_connect` - WebSocketè¿æ¥å»ºç«‹
- `http_get/post` - HTTPè¯·æ±‚

### WebSocketäº‹ä»¶
- **å‘é€äº‹ä»¶ (SEND)**:
  - `conversation_start` - å¼€å§‹å¯¹è¯
  - `message_start` - å¼€å§‹æ¶ˆæ¯
  - `audio_stream` - éŸ³é¢‘æµ
  - `message_end` - ç»“æŸæ¶ˆæ¯
  - `manual_generate` - æ‰‹åŠ¨ç”Ÿæˆ
  - `user_modification` - ç”¨æˆ·ä¿®æ”¹
  - `response_count_update` - æ›´æ–°å›ç­”æ•°é‡
  - `conversation_end` - ç»“æŸå¯¹è¯

- **æ¥æ”¶äº‹ä»¶ (RECV)**:
  - `session_created` - ä¼šè¯åˆ›å»ºç¡®è®¤
  - `message_recorded` - æ¶ˆæ¯è®°å½•ç¡®è®¤
  - `opinion_suggestions` - æ„è§å»ºè®®
  - `llm_response` - LLMå›ç­”
  - `status_update` - çŠ¶æ€æ›´æ–°
  - `error` - é”™è¯¯äº‹ä»¶

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨
```python
from remote_test_base import RemoteTestBase

# åˆ›å»ºæµ‹è¯•å®ä¾‹ï¼ˆä¼šè‡ªåŠ¨åŠ è½½æ—¥å¿—é…ç½®ï¼‰
tester = RemoteTestBase("remote_test_config.json")

# è¿è¡Œæµ‹è¯•ï¼ˆäº‹ä»¶ä¼šè‡ªåŠ¨è®°å½•ï¼‰
websocket = await tester.connect_websocket()
await tester.send_websocket_event(websocket, "conversation_start", {...})
event = await tester.receive_websocket_event(websocket, "session_created")

# æ˜¾ç¤ºäº‹ä»¶ç»Ÿè®¡
tester.print_event_summary()

# ä¿å­˜æŠ¥å‘Šï¼ˆåŒ…å«äº‹ä»¶æ—¥å¿—ï¼‰
tester.save_test_report("my_test_report.json")
```

### é«˜çº§é…ç½®
```python
# æ¸…ç©ºäº‹ä»¶æ—¥å¿—ï¼ˆæ–°æµ‹è¯•å¼€å§‹æ—¶ï¼‰
tester.clear_event_log()

# è·å–äº‹ä»¶ç»Ÿè®¡
stats = tester._get_event_statistics()
print(f"æ€»äº‹ä»¶æ•°: {stats['total_events']}")
print(f"å¹³å‡å“åº”æ—¶é—´: {stats['average_response_time']}ç§’")
```

## è°ƒè¯•æŠ€å·§

### é—®é¢˜è¯Šæ–­
1. **è¿æ¥é—®é¢˜**: æŸ¥çœ‹ `websocket_connect` äº‹ä»¶çš„é”™è¯¯ä¿¡æ¯
2. **è¶…æ—¶é—®é¢˜**: æ£€æŸ¥ `response_time` å’Œ `timeout` å…ƒæ•°æ®
3. **æ•°æ®é—®é¢˜**: æŸ¥çœ‹äº‹ä»¶æ•°æ®å†…å®¹å’Œ `message_size`
4. **åºåˆ—é—®é¢˜**: ä½¿ç”¨äº‹ä»¶åºåˆ—å·è¿½è¸ªäº‹ä»¶é¡ºåº

### æ€§èƒ½åˆ†æ
- é€šè¿‡ `average_response_time` åˆ†ææ•´ä½“æ€§èƒ½
- æŸ¥çœ‹å•ä¸ªäº‹ä»¶çš„ `response_time` æ‰¾å‡ºç“¶é¢ˆ
- ç»Ÿè®¡ä¸åŒäº‹ä»¶ç±»å‹çš„æ•°é‡åˆ†å¸ƒ

### é”™è¯¯è¿½è¸ª
- æŸ¥çœ‹å¤±è´¥äº‹ä»¶çš„ `error` å…ƒæ•°æ®
- æ£€æŸ¥äº‹ä»¶åºåˆ—æ‰¾å‡ºå¤±è´¥æ¨¡å¼
- åˆ†æ `type_mismatch` æ£€æµ‹åè®®é—®é¢˜

## æœ€ä½³å®è·µ

1. **ç”Ÿäº§ç¯å¢ƒ**: è®¾ç½® `log_level` ä¸º `INFO` æˆ– `WARNING`
2. **è°ƒè¯•é˜¶æ®µ**: ä½¿ç”¨ `DEBUG` çº§åˆ«å’Œ `show_list_items: true`
3. **æ€§èƒ½æµ‹è¯•**: å…³é—­è¯¦ç»†æ—¥å¿—æ˜¾ç¤ºä»¥é¿å…å½±å“æµ‹è¯•ç»“æœ
4. **é•¿æœŸè¿è¡Œ**: å¯ç”¨æ–‡ä»¶æ—¥å¿—è®°å½•ä¾¿äºåç»­åˆ†æ

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: æ—¥å¿—æ˜¾ç¤ºè¿‡å¤šä¿¡æ¯**
A: è®¾ç½® `enable_detailed_logging: false` æˆ–è°ƒæ•´ `log_level`

**Q: æ–‡ä»¶æ—¥å¿—æ²¡æœ‰ç”Ÿæˆ**
A: æ£€æŸ¥ `enable_file_logging` è®¾ç½®å’Œæ–‡ä»¶å†™å…¥æƒé™

**Q: éŸ³é¢‘æ•°æ®æ˜¾ç¤ºä¸º `<audio_data_length:xxx>`**
A: è¿™æ˜¯æ­£å¸¸çš„è„±æ•å¤„ç†ï¼Œä¿æŠ¤æ•æ„Ÿæ•°æ®

**Q: äº‹ä»¶ç»Ÿè®¡æ˜¾ç¤ºå¼‚å¸¸**
A: æ£€æŸ¥æ˜¯å¦åœ¨æµ‹è¯•ä¸­é€”è°ƒç”¨äº† `clear_event_log()`

---

## ç‰ˆæœ¬å†å²

- **v1.0.0** - åˆå§‹ç‰ˆæœ¬ï¼ŒåŸºæœ¬äº‹ä»¶è®°å½•åŠŸèƒ½
- **v1.1.0** - å¢åŠ è¯¦ç»†ç»Ÿè®¡å’Œæ–‡ä»¶æ—¥å¿—
- **v1.2.0** - å¢åŠ æ•æ„Ÿä¿¡æ¯è„±æ•å’Œæ€§èƒ½ä¼˜åŒ–